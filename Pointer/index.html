<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêï</text></svg>">
  <title>Calculadora de Pre√ßos - Atividade Noturna</title>
  <meta name="description" content="Calculadora de pre√ßos para servi√ßos de Atividade Noturna e Sobreaviso">
  <script src="https://unpkg.com/vue@3.5.13/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <!-- Cabe√ßalho Mobile (apenas em telas pequenas) -->
  <div class="bg-blue-950 text-white p-4 md:hidden flex justify-between items-center">
    <div class="text-2xl">
      <img src="https://pointertech.digital/assets/LOGO_TAG_FUNDO_AZUL-xrB-CNDi.png" alt="Logo Pointer" class="h-8">
    </div>
    <button @click="toggleSidebar" class="focus:outline-none">
      <!-- √çcone Hamburger -->
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>

  <!-- Sidebar -->
  <aside :class="{'translate-x-0': showSidebar, '-translate-x-full': !showSidebar}" class="fixed inset-y-0 left-0 w-64 bg-blue-950 text-white transform md:translate-x-0 transition duration-300 ease-in-out p-4">
    <div class="text-4xl">
      <img src="https://pointertech.digital/assets/LOGO_TAG_FUNDO_AZUL-xrB-CNDi.png" alt="Logo Pointer">
    </div>
    <nav class="mt-6 w-full">
      <ul class="space-y-4 text-lg">
        <li>
          <a href="#" @click.prevent="currentPage = 'inicio'; toggleSidebar()" class="block p-2 rounded hover:bg-gray-700">
            In√≠cio
          </a>
        </li>
        <li>
          <a href="#" @click.prevent="currentPage = 'calculadora'; toggleSidebar()" class="block p-2 rounded hover:bg-gray-700">
            Calculadora
          </a>
        </li>
      </ul>
      <!-- Bot√£o para download do CSV -->
      <button id="downloadCsv" class="mt-6 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 flex justify-center w-full">
        Baixar CSV
      </button>
    </nav>
  </aside>

  <!-- Conte√∫do Principal -->
  <div id="app" class="container mx-auto p-4 md:ml-64">
    <div v-if="currentPage === 'inicio'">
      <!-- Conte√∫do da p√°gina de in√≠cio -->
    </div>

    <div v-if="currentPage === 'calculadora'">
      <div class="w-full mx-auto bg-white rounded-lg shadow-lg p-6">
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-2xl font-bold">Calculadora de Horas de Servi√ßo</h1>
          <div>
            <div class="text-xl font-bold">Total Mensal: {{ formatCurrency(total) }}</div>
            <div class="text-xl font-bold">Total Anual: {{ formatCurrency(total * 12) }}</div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-1">Nome do Cliente</label>
            <input type="text" v-model="cliente" class="w-full border rounded p-2">
          </div>
          <div></div>
          <div>
            <label class="block text-sm font-medium mb-1">N√∫mero de Clientes</label>
            <select v-model="clientRange" class="w-full border rounded p-2">
              <option value="1 a 20">1 a 20</option>
              <option value="21 a 50">21 a 50</option>
              <option value="51 a 100">51 a 100</option>
              <option value="101 a 200">101 a 200</option>
              <option value="201 a 500">201 a 500</option>
              <option value="501 a 1000">501 a 1.000</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Total de Horas</label>
            <input type="number" v-model.number="hours" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Tipo de Servi√ßo</label>
            <select v-model="serviceType" class="w-full border rounded p-2">
              <option value="suporte">Suporte</option>
              <option value="installation">Instala√ß√£o</option>
              <option value="Treinamento">Treinamento</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Perfis -->
      <div class="flex flex-col md:flex-row items-center md:items-start gap-4 mb-6">
        <div v-for="(profile, index) in profiles" :key="index" class="w-full md:w-1/3 bg-white rounded-lg shadow-lg m-2 p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-lg font-semibold mb-2">Perfil {{ index + 1 }}</h2>
            <button @click="removeProfile(index)" class="mt-4 bg-red-500 text-white rounded-full h-10 w-10 flex items-center justify-center">
              -
            </button>
          </div>
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Perfil</label>
            <select v-model="profile.type" class="w-full border rounded p-2">
              <option value="operator">Operador</option>
              <option value="analyst1">Analista N1</option>
              <option value="analyst2">Analista N2</option>
              <option value="analyst3">Analista N3</option>
              <option value="specialist">Especialista</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium">Atividade Noturna</label>
              <input type="number" v-model.number="profile.nortuna" class="w-full border rounded p-2">
            </div>
            <div>
              <label class="block text-sm font-medium">Sobreaviso</label>
              <input type="number" v-model.number="profile.standby" class="w-full border rounded p-2">
            </div>
          </div>

          <div class="mt-6">
            <label class="block text-sm font-medium mb-2">Descri√ß√£o</label>
            <textarea v-model="profile.description" class="w-full border rounded p-2" rows="3"></textarea>
          </div>

          <div class="mt-6 p-4 bg-gray-100 rounded">
            <h2 class="font-semibold mb-2">C√°lculo:</h2>
            <p>Base ({{ profileLabel(profile.type) }}) = {{ formatCurrency(baseRate(profile.type)) }}</p>
            <p>{{ formatCurrency(baseRate(profile.type)) }} * {{ clientRate(clientRange) }} (N√∫mero de Clientes ({{ clientRange }}))</p>
            <p>{{ formatCurrency(baseRate(profile.type) * clientRate(clientRange)) }} * {{ hours }} (Horas)</p>
            <p>{{ formatCurrency((baseRate(profile.type) * clientRate(clientRange)) * hours) }} * {{ serviceRate(serviceType) }} ({{ serviceType }})</p>
            <p>Total: {{ formatCurrency(((baseRate(profile.type) * clientRate(clientRange)) * hours) * serviceRate(serviceType)) }}</p>
            <br>
            <p>Ativ. Noturna (25%): {{ profile.nortuna }} * {{ formatCurrency(baseRate(profile.type) * 1.25) }} = {{ formatCurrency((profile.nortuna * baseRate(profile.type)) * 1.25) }}</p>
            <p>Sobreaviso (33%): {{ profile.standby }} * {{ formatCurrency(baseRate(profile.type) * 1.33) }} = {{ formatCurrency((profile.standby * baseRate(profile.type)) * 1.33) }}</p>
          </div>
        </div>
      </div>
      <div class="flex justify-center mt-4">
        <button @click="addProfile" class="bg-green-500 text-white px-4 py-2 rounded">
          Adicionar Perfil
        </button>
      </div>
    </div>

    <div v-if="currentPage === 'certificacao'">
      <div class="w-full mx-auto bg-white rounded-lg shadow-lg p-6">
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-2xl font-bold">Certifica√ß√£o</h1>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-1">Nome</label>
            <input type="text" v-model.number="nome" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Curso</label>
            <input type="text" v-model.number="curso" class="w-full border rounded p-2">
          </div>
          <div class="flex justify-center mt-4">
            <button @click="addProfile" class="bg-green-500 text-white px-4 py-2 rounded">
              Imprimir
            </button>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-1">N√∫mero de Clientes</label>
            <select v-model="clientRange" class="w-full border rounded p-2">
              <option value="1 a 20">1 a 20</option>
              <option value="21 a 50">21 a 50</option>
              <option value="51 a 100">51 a 100</option>
              <option value="101 a 200">101 a 200</option>
              <option value="201 a 500">201 a 500</option>
              <option value="501 a 1000">501 a 1.000</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Total de Horas</label>
            <input type="number" v-model.number="hours" class="w-full border rounded p-2">
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Logo Empresa</label>
            <input type="file" id="companyLogo" class="w-full border rounded p-2">
          </div>

          <div>
            <label class="block text-sm font-medium mb-1">Provedor</label>
            <input type="file" id="provedorLogo" class="w-full border rounded p-2">
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-1 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-1">Descri√ß√£o</label>
            <input type="text" id="project" class="w-full border rounded p-2">
          </div>
        </div>
      </div>

      <div class="flex items-center grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <!-- Conte√∫do extra, se necess√°rio -->
      </div>
    </div>

    <div v-if="currentPage === 'configuracao'">
      <!-- Conte√∫do de Configura√ß√µes -->
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          currentPage: 'calculadora', // P√°gina inicial
          showSidebar: false,
          cliente: '',
          clientRange: '1 a 20',
          hours: 0,
          serviceType: 'suporte',
          profiles: [
            { type: 'operator', nortuna: 0, standby: 0, description: '' }
          ]
        };
      },
      computed: {
        total() {
          return this.profiles.reduce((sum, profile) => {
            const profileTotal = ((this.baseRate(profile.type) * this.clientRate(this.clientRange)) * this.hours * this.serviceRate(this.serviceType))
              + ((profile.nortuna * this.baseRate(profile.type)) * 1.25)
              + ((profile.standby * this.baseRate(profile.type)) * 1.33);
            return sum + profileTotal;
          }, 0);
        }
      },
      methods: {
        toggleSidebar() {
          this.showSidebar = !this.showSidebar;
        },
        baseRate(type) {
          const rates = {
            'operator': 23.54,
            'analyst1': 53.10,
            'analyst2': 69.94,
            'analyst3': 110.32,
            'specialist': 180.11
          };
          return rates[type] || 0;
        },
        clientRate(range) {
          const rates = {
            '1 a 20': 1,
            '21 a 50': 1.05,
            '51 a 100': 1.1,
            '101 a 200': 1.15,
            '201 a 500': 1.2,
            '501 a 1000': 1.25
          };
          return rates[range] || 1;
        },
        serviceRate(type) {
          const rates = {
            'suporte': 1,
            'installation': 2,
            'Treinamento': 5
          };
          return rates[type] || 1;
        },
        profileLabel(type) {
          const labels = {
            'operator': 'Operador',
            'analyst1': 'Analista N1',
            'analyst2': 'Analista N2',
            'analyst3': 'Analista N3',
            'specialist': 'Especialista'
          };
          return labels[type] || 'Operador';
        },
        formatCurrency(value) {
          return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        },
        addProfile() {
          this.profiles.push({ type: 'operator', nortuna: 0, standby: 0, description: '' });
        },
        removeProfile(index) {
          if (this.profiles.length > 1) {
            this.profiles.splice(index, 1);
          }
        },
        downloadCSV() {
          // Define o nome do arquivo
          const fileName = `(POINTER) ${this.cliente} - Calculadora de servi√ßo.csv`;

          // Cabe√ßalho dos dados do servi√ßo
          const serviceHeader = [
            "Cliente",
            "Usuarios Cliente",
            "Horas",
            "Tipo de Servico",
            "Valor Mensal",
            "Valor Anual"
          ].join(";");

          // Linha de informa√ß√µes gerais do servi√ßo
          const serviceRow = [
            this.cliente,
            this.clientRange,
            this.hours,
            this.serviceType,
            this.total.toFixed(2),
            (this.total * 12).toFixed(2)
          ].join(";");

          // Linha separadora
          const dashedLine = "-;-;-;-;-;-;";

          // Cabe√ßalho dos dados dos perfis
          const profileHeader = [
            "Perfil",
            "Base",
            "Parcial",
            "Atividade Noturna",
            "Sobreaviso",
            "Descricao",
            "Atividade Noturna",
            "Sobreaviso",
            "Total Parcial"
          ].join(";");

          // Linhas com os dados de cada perfil
          const profileRows = this.profiles.map(profile => {
            const calculatedNoturna = (profile.nortuna * this.baseRate(profile.type) * 1.25).toFixed(2);
            const calculatedStandby = (profile.standby * this.baseRate(profile.type) * 1.33).toFixed(2);
            // C√°lculo da base
            const baseCalculation = this.baseRate(profile.type) *
                                    this.clientRate(this.clientRange) *
                                    this.hours *
                                    this.serviceRate(this.serviceType);
            const baseRounded = parseFloat(baseCalculation.toFixed(2));

            // C√°lculo da Atividade Noturna
            const noturnaCalc = profile.nortuna * this.baseRate(profile.type) * 1.25;
            const noturnaRounded = parseFloat(noturnaCalc.toFixed(2));

            // C√°lculo do Sobreaviso
            const standbyCalc = profile.standby * this.baseRate(profile.type) * 1.33;
            const standbyRounded = parseFloat(standbyCalc.toFixed(2));

            // Soma num√©rica
            const profileCalculate = baseRounded + noturnaRounded + standbyRounded;
            const profileCalculateFormatted = profileCalculate.toFixed(2);
            
            return [
              this.profileLabel(profile.type),
              this.baseRate(profile.type),
              baseRounded,
              profile.nortuna,
              profile.standby,
              profile.description,
              calculatedNoturna,
              calculatedStandby,
              profileCalculateFormatted
            ].join(";");
          });

          // Junta todas as linhas com quebras de linha
          const csvContent = [serviceHeader, serviceRow, dashedLine, profileHeader, ...profileRows].join("\n");

          // Cria um Blob com o conte√∫do CSV e inicia o download
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement("a");
          if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          } else if (navigator.msSaveBlob) {
            navigator.msSaveBlob(blob, fileName);
          }
        }
      },
      mounted() {
        // Vincula o evento de download ao bot√£o fora do container Vue
        const downloadBtn = document.getElementById('downloadCsv');
        if (downloadBtn) {
          downloadBtn.addEventListener('click', this.downloadCSV);
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
